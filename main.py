
from machine import Pin, Timer
import ina219
import oled
import framebuf

import time


#Static variables
led = Pin(25, Pin.OUT)
battery = ina219.INA219(addr=0x43)
timer = Timer()
screen = oled.OLED_1inch3()
screen.flip()
keyA = Pin(15,Pin.IN,Pin.PULL_UP)
keyB = Pin(17,Pin.IN,Pin.PULL_UP)
prevKeyA=False
prevKeyB=False
activitiesLookup={0:" ",1:"Y",2:"E",3:"R",4:"H"}

#Binary data for gui template
template_nobutton=bytearray(b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x1e\x841\xc2\x0fa\x8c\xf0C\xf8!x\x00\xfb\xbf\x013\x84;\x02\x03a\x8c\xc0@\x18 \xcc\x00\xfb\xbf\x01\x03\x84?\x02\x03a\x8c\xc0@\x18 \x0c\x00\xfb\xbf\x01\x1e\x845\x02\x03a\x8d\xc0@x x\x00\xfb\xbf\x010\x841\x02\x03\xe1\x8f\xc0@\x18 \xc0\x00\xfb\xbf\x013\x841\x02\x03\xe1\x8e\xc0@\x18 \xcc\x00\xfb\xbf\x01\x1e\x841\x02\x03a\x8c\xc0@\x18 x\x00\xfb\xbe\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbc\xf9\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x1f\x0b\xba\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xeb\xb7\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xeb\xaf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xeb\xb7\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x0b\xba\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbc\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbe\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbe\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\xfb\xbe\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00{\xbd\x01\x00\x00\x00\x00\x00 \x00\x00\x00\x00\x0e\x00\x00;\xb9\xe1\x7f\x00\x00\x00\x80p\x00\x00\x00\x80?\x00\x00\xcb\xa7\xc1?\x00\x00\x00\x80Q\x00\x00\x00\x80 \x00\x00;\xb9\xf1\xff\x00\x00\x00\x80J\x00\x00\x00\x80 \x00\x00{\xbd\xc9?\x01\x00\x00\x80F\x02\x00\x00\x80 \x00\x00\xfb\xbe\xc9?\x01\x00\x00\x80 \x03\x00\x00\x80 \x00\x00\xfb\xbe\xc9?\x01\x00\x00\x80\xa4\x02\x00\x00\x80 \x00\x00\xfb\xbf\xf1\xff\x00\x00\x00@\xcc\x02\x00\x00\x80 \x00\x00\xfb\xbf\x81\x1f\x00\x00\x00@\x1e\x02\x00\x00\x80 \x00\x00\xfb\xbf\x01\x0f\x00\x00\x00@\x1e\x01\x00\x00\x80 \x00\x00\xfb\xbf\x01\x06\x00\x00\x00\xc0\x0c\x01\x00\x00\x80 \x00\x00\xfb\xbf\x01\x06\x00\x00\x00\x80\x80\x00\x00\x00\x80 \x00\x00\xfb\xbf\x01\x06\x00\x00\x00\x80a\x00\x00\x00\x80 \x00\x00\xfb\xbf\x81\x1f\x00\x00\x00\x003\x00\x00\x00\x80 \x00\x00\xfb\xbf\x81\x1f\x00\x00\x00\x00\x1e\x00\x00\x00\x80?\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff')
template_bottombutton=bytearray(b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x1e\x841\xc2\x0fa\x8c\xf0C\xf8!x\x00\xfb\xbf\x013\x84;\x02\x03a\x8c\xc0@\x18 \xcc\x00\xfb\xbf\x01\x03\x84?\x02\x03a\x8c\xc0@\x18 \x0c\x00\xfb\xbf\x01\x1e\x845\x02\x03a\x8d\xc0@x x\x00\xfb\xbf\x010\x841\x02\x03\xe1\x8f\xc0@\x18 \xc0\x00\xfb\xbf\x013\x841\x02\x03\xe1\x8e\xc0@\x18 \xcc\x00\xfb\xbf\x01\x1e\x841\x02\x03a\x8c\xc0@\x18 x\x00\xfb\xbe\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbc\xf9\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x1f\x0b\xba\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xeb\xb7\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xeb\xaf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xeb\xb7\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x0b\xba\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbc\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbe\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x81\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x03\x81\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x83\x82\x01\x00\x00\x00\x00\x00 \x00\x00\x00\x00\x0e\x00\x00\xc3\x86\xe1\x7f\x00\x00\x00\x80p\x00\x00\x00\x80?\x00\x003\x98\xc1?\x00\x00\x00\x80Q\x00\x00\x00\x80 \x00\x00\xc3\x86\xf1\xff\x00\x00\x00\x80J\x00\x00\x00\x80 \x00\x00\x83\x82\xc9?\x01\x00\x00\x80F\x02\x00\x00\x80 \x00\x00\x03\x81\xc9?\x01\x00\x00\x80 \x03\x00\x00\x80 \x00\x00\x03\x81\xc9?\x01\x00\x00\x80\xa4\x02\x00\x00\x80 \x00\x00\x03\x80\xf1\xff\x00\x00\x00@\xcc\x02\x00\x00\x80 \x00\x00\x03\x80\x81\x1f\x00\x00\x00@\x1e\x02\x00\x00\x80 \x00\x00\x03\x80\x01\x0f\x00\x00\x00@\x1e\x01\x00\x00\x80 \x00\x00\x03\x80\x01\x06\x00\x00\x00\xc0\x0c\x01\x00\x00\x80 \x00\x00\x03\x80\x01\x06\x00\x00\x00\x80\x80\x00\x00\x00\x80 \x00\x00\x03\x80\x01\x06\x00\x00\x00\x80a\x00\x00\x00\x80 \x00\x00\x03\x80\x81\x1f\x00\x00\x00\x003\x00\x00\x00\x80 \x00\x00\x03\x80\x81\x1f\x00\x00\x00\x00\x1e\x00\x00\x00\x80?\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff')
template_topbutton=bytearray(b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x1e\x841\xc2\x0fa\x8c\xf0C\xf8!x\x00\x03\x80\x013\x84;\x02\x03a\x8c\xc0@\x18 \xcc\x00\x03\x80\x01\x03\x84?\x02\x03a\x8c\xc0@\x18 \x0c\x00\x03\x80\x01\x1e\x845\x02\x03a\x8d\xc0@x x\x00\x03\x80\x010\x841\x02\x03\xe1\x8f\xc0@\x18 \xc0\x00\x03\x80\x013\x841\x02\x03\xe1\x8e\xc0@\x18 \xcc\x00\x03\x80\x01\x1e\x841\x02\x03a\x8c\xc0@\x18 x\x00\x03\x81\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x83\xf9\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x1f\xf3\x85\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x13\x88\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x13\x90\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x13\x88\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xf3\x85\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x83\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x81\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfb\xbe\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\xfb\xbe\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00{\xbd\x01\x00\x00\x00\x00\x00 \x00\x00\x00\x00\x0e\x00\x00;\xb9\xe1\x7f\x00\x00\x00\x80p\x00\x00\x00\x80?\x00\x00\xcb\xa7\xc1?\x00\x00\x00\x80Q\x00\x00\x00\x80 \x00\x00;\xb9\xf1\xff\x00\x00\x00\x80J\x00\x00\x00\x80 \x00\x00{\xbd\xc9?\x01\x00\x00\x80F\x02\x00\x00\x80 \x00\x00\xfb\xbe\xc9?\x01\x00\x00\x80 \x03\x00\x00\x80 \x00\x00\xfb\xbe\xc9?\x01\x00\x00\x80\xa4\x02\x00\x00\x80 \x00\x00\xfb\xbf\xf1\xff\x00\x00\x00@\xcc\x02\x00\x00\x80 \x00\x00\xfb\xbf\x81\x1f\x00\x00\x00@\x1e\x02\x00\x00\x80 \x00\x00\xfb\xbf\x01\x0f\x00\x00\x00@\x1e\x01\x00\x00\x80 \x00\x00\xfb\xbf\x01\x06\x00\x00\x00\xc0\x0c\x01\x00\x00\x80 \x00\x00\xfb\xbf\x01\x06\x00\x00\x00\x80\x80\x00\x00\x00\x80 \x00\x00\xfb\xbf\x01\x06\x00\x00\x00\x80a\x00\x00\x00\x80 \x00\x00\xfb\xbf\x81\x1f\x00\x00\x00\x003\x00\x00\x00\x80 \x00\x00\xfb\xbf\x81\x1f\x00\x00\x00\x00\x1e\x00\x00\x00\x80?\x00\x00\xfb\xbf\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff')
template_bothbutton=bytearray(b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x1e\x841\xc2\x0fa\x8c\xf0C\xf8!x\x00\x03\x80\x013\x84;\x02\x03a\x8c\xc0@\x18 \xcc\x00\x03\x80\x01\x03\x84?\x02\x03a\x8c\xc0@\x18 \x0c\x00\x03\x80\x01\x1e\x845\x02\x03a\x8d\xc0@x x\x00\x03\x80\x010\x841\x02\x03\xe1\x8f\xc0@\x18 \xc0\x00\x03\x80\x013\x841\x02\x03\xe1\x8e\xc0@\x18 \xcc\x00\x03\x80\x01\x1e\x841\x02\x03a\x8c\xc0@\x18 x\x00\x03\x81\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x83\xf9\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x1f\xf3\x85\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x13\x88\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x13\x90\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x13\x88\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\xf3\x85\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x83\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x81\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x04\x00\x02\x00\x01\x80\x00@\x00 \x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x81\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x03\x81\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x83\x82\x01\x00\x00\x00\x00\x00 \x00\x00\x00\x00\x0e\x00\x00\xc3\x86\xe1\x7f\x00\x00\x00\x80p\x00\x00\x00\x80?\x00\x003\x98\xc1?\x00\x00\x00\x80Q\x00\x00\x00\x80 \x00\x00\xc3\x86\xf1\xff\x00\x00\x00\x80J\x00\x00\x00\x80 \x00\x00\x83\x82\xc9?\x01\x00\x00\x80F\x02\x00\x00\x80 \x00\x00\x03\x81\xc9?\x01\x00\x00\x80 \x03\x00\x00\x80 \x00\x00\x03\x81\xc9?\x01\x00\x00\x80\xa4\x02\x00\x00\x80 \x00\x00\x03\x80\xf1\xff\x00\x00\x00@\xcc\x02\x00\x00\x80 \x00\x00\x03\x80\x81\x1f\x00\x00\x00@\x1e\x02\x00\x00\x80 \x00\x00\x03\x80\x01\x0f\x00\x00\x00@\x1e\x01\x00\x00\x80 \x00\x00\x03\x80\x01\x06\x00\x00\x00\xc0\x0c\x01\x00\x00\x80 \x00\x00\x03\x80\x01\x06\x00\x00\x00\x80\x80\x00\x00\x00\x80 \x00\x00\x03\x80\x01\x06\x00\x00\x00\x80a\x00\x00\x00\x80 \x00\x00\x03\x80\x81\x1f\x00\x00\x00\x003\x00\x00\x00\x80 \x00\x00\x03\x80\x81\x1f\x00\x00\x00\x00\x1e\x00\x00\x00\x80?\x00\x00\x03\x80\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x80\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff')

#Load persistent varables
bestStreak=999
currentStreak=123
curDay=0
activities=[0]*7


def getBatteryPct():
    bus_voltage = battery.getBusVoltage_V()
    pct = (bus_voltage -3)/1.2*100
    if(pct<0):pct=0
    elif(pct>100):pct=100
    return(pct)


def loadTemplateScreen(bottomPressed=False,topPressed=False):
    screen.fill(0x0000)
    if bottomPressed and topPressed:
        data=template_bothbutton
    elif bottomPressed:
        data=template_bottombutton
    elif topPressed:
        data=template_topbutton
    else:
        data=template_nobutton
    fbuf = framebuf.FrameBuffer(data,128,64,framebuf.MONO_HMSB)
    screen.blit(fbuf, 0, 0)
    screen.text("YogaExrRunHike",1,35,screen.white)

def loadBateryPct():
    screen.text(str(int(getBatteryPct())),95,51,screen.white)

def loadStreaks():
    screen.text(str(bestStreak),17,51,screen.white)
    screen.text(str(currentStreak),59,51,screen.white)

def drawSelector():
    if time.time()%2==0:
        x=6+(curDay*15)
        screen.fill_rect(x,17,10,10,screen.white)

def drawActivity():
    c=0
    for day in activities:
        x=6+1+(c*15)
        screen.text(activitiesLookup[activities[c]],x,19,screen.white)
        c+=1
    
def refreshScreen():
    global prevKeyA
    global prevKeyB
    global curDay
    global activities
    keyAPressed=keyA.value()==0
    keyBPressed=keyB.value()==0
    loadTemplateScreen(keyAPressed,keyBPressed)
    if keyBPressed and not prevKeyB:
        curDay=(curDay+1)%7
    if keyAPressed and not prevKeyA:
        activities[curDay]=(activities[curDay]+1)%5
    loadBateryPct()
    loadStreaks()
    drawActivity()
    drawSelector()
    
    screen.show()
    prevKeyA=keyAPressed
    prevKeyB=keyBPressed

#timer.init(freq=1.5, mode=Timer.PERIODIC, callback=refreshScreen)
#def refreshScreen(timer):
#    refreshScreen()
    
while True:
    refreshScreen()